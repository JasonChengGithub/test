if (!accessoryList) {
	var accessoryList = [];
}
$("body").on('click', '.uploadFile .uploadRemove', function () {
	var index = $(this).attr("data-index")
	accessoryList.splice(index, 1)
	updateUploadList(accessoryList)
})

$("body").off('change', '.uploadFile #uploadBtn').on('change', '.uploadFile #uploadBtn', function () {
	var apkIntroduce = $(this).val();
	var filename = apkIntroduce.replace(/.*(\/|\\)/, "");
	var fileExt = (/[.]/.exec(filename)) ? /[^.]+$/.exec(filename.toLowerCase()) : '';
	var fileType = JSON.parse($(this).attr("data-fileType"))
	var typeState = false;
	if (fileType.length > 0) {
		for (var j = 0; j < fileType.length; j++) {
			if (fileType[j] == fileExt) {
				typeState = true
				break
			}
		}
	} else {
		typeState = true
	}
	if (!typeState) {
		alert("上传文件格式不符合要求！")
		return
	}
	var loader = layer.load(1, {
		shade: [0.3, '#000'] //0.1透明度的白色背景
	});
	$.ajaxFileUpload({
		url: l.domainName + 'uploadFiles.do', //用于文件上传的服务器端请求地址
		secureuri: false, //是否需要安全协议，一般设置为false
		fileElementId: 'uploadBtn', //文件上传域的ID
		dataType: 'text', //返回值类型 一般设置为json
		complete: function (result) {
			layer.close(loader)
		},
		success: function (data, status) { //服务器成功响应处理函数
			data = JSON.parse(data)
			if (data.success == "true") {
				accessoryList.push({
					fileName: data.fileName,
					fileUrl: data.fileUrl
				})
				updateUploadList(accessoryList)
			} else {
				console.log(data.message)
			}
		},
		error: function (data, status, e) {//服务器响应失败处理函数
			console.log(e)
		}
	})
})
function updateUploadList(_uploadList, disabled) {
	$(".uploadFile .uploadList").html("");
	if (disabled && !_uploadList.length > 0) {
		$(".uploadFile .uploadList").append("<li class='uploadItem'>无附件</li>")
	} else {
		$.each(_uploadList, function (i, v) {
			$(".uploadFile .uploadList").append("<li class='uploadItem'><a target='_blank' href='" + v.fileUrl + "'>" + v.fileName + "</a>" + (disabled ? "" : "<i data-index='" + i + "' class='uploadRemove icon Hui-iconfont pl-10 pr-10'></i>") + "</li>")
		})
	}

}
function getUploadList() {
	return accessoryList
}